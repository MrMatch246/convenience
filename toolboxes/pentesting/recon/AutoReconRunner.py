import argparse
import subprocess
from pathlib import Path

def run_autorecon(project_folder, hosts_file, config=None, targets=None, autorecon_config=None):
    project_folder = Path(project_folder)
    output_dir = project_folder / "recon/hosts"
    output_dir.mkdir(parents=True, exist_ok=True)

    cmd = ["autorecon", "-t", hosts_file, "-o", str(output_dir)]
    if config:
        cmd.extend(["--config", config])
    if targets:
        cmd.extend(["--targets", targets])
    if autorecon_config:
        cmd.extend(["--autorecon-config", autorecon_config])

    subprocess.run(cmd, check=True)

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--project", required=True)
    parser.add_argument("--hosts", required=True)
    parser.add_argument("--config", help="Config file for AutoRecon")
    parser.add_argument("--targets", help="Original targets file")
    parser.add_argument("--autorecon-config", help="Config file for AutoRecon scan parameters")
    args = parser.parse_args()
    run_autorecon(args.project, args.hosts, args.config, args.targets, args.autorecon_config)
